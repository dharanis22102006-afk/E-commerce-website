<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Vintage Store</title>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<style>
/* ---------- Base with vintage background IMAGE ---------- */
body {
  font-family: 'Georgia', 'Times New Roman', serif;
  margin:0;
  background-image:
    url('https://cdn.photoroom.com/v2/image-cache?path=gs://background-7ef44.appspot.com/backgrounds_v3/vintage/46_vintage.jpg'),
    linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.3));
  background-size: cover, cover;
  background-position: center, center;
  background-repeat: no-repeat, no-repeat;
  background-attachment: fixed, fixed;
  color:#2b2420;
  min-height: 100vh;
  position: relative;
}
/* HIDE floating words */
.vintage-layer, .floating-word { display: none !important; }
header {
  background: linear-gradient(45deg, rgba(0,128,128,0.95), rgba(0,139,139,0.95));
  color:white;
  padding:12px 15px;
  position:fixed;
  top:0;
  left:0;
  right:0;
  display:flex;
  justify-content:space-between;
  align-items:center;
  z-index:1000;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  backdrop-filter: blur(10px);
}
header h2 { margin:0; font-size:1.1rem; display:flex; align-items:center; gap:8px }
nav { display:flex; align-items:center; gap:4px; flex-wrap:wrap; }
nav a, .logout-btn {
  margin:2px 4px;
  color:white;
  text-decoration:none;
  font-weight:600;
  cursor:pointer;
  font-size:0.9rem;
  padding:4px 8px;
  border-radius:4px;
  transition: background 0.2s;
}
nav a:hover, .logout-btn:hover {
  background: rgba(255,255,255,0.2);
  text-decoration:none;
}
main { padding:80px 15px 20px; }
section { display:none; }
section.active { display:block; }
/* ---------- Notification Styling ---------- */
#notification {
  position: fixed;
  top: 70px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(255,255,255,0.9);
  color: #2b2420;
  padding: 12px 20px;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  z-index: 2000;
  max-width: 90%;
  text-align: center;
  font-weight: 600;
  display: none;
  animation: fadeInOut 3s ease-in-out;
}
#notification.show {
  display: block;
}
@keyframes fadeInOut {
  0% { opacity: 0; transform: translate(-50%, -10px); }
  10% { opacity: 1; transform: translate(-50%, 0); }
  90% { opacity: 1; transform: translate(-50%, 0); }
  100% { opacity: 0; transform: translate(-50%, -10px); }
}
/* ---------- Login/Register ---------- */
#login-container, #register-container {
  max-width:400px;
  margin:100px auto;
  padding:25px;
  background:rgba(255,255,255,0.8);
  border-radius:14px;
  box-shadow:0 8px 25px rgba(0,0,0,0.15);
  backdrop-filter: blur(10px);
  border:1px solid rgba(255,255,255,0.3);
}
#login-container h2, #register-container h2 {
  text-align:center;
  margin-bottom:18px;
  color:#2b2420;
  font-family: Georgia, serif;
}
#login-container input, #register-container input {
  width:100%;
  padding:12px;
  margin-bottom:12px;
  border-radius:8px;
  border:1px solid #d4c8a8;
  background:rgba(255,255,255,0.9);
  box-sizing: border-box;
}
#login-container button, #register-container button {
  width:100%;
  padding:12px;
  border:none;
  border-radius:8px;
  background:linear-gradient(45deg, teal, darkcyan);
  color:white;
  cursor:pointer;
  font-weight:600;
  font-family: inherit;
}
#login-container button:hover, #register-container button:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,128,128,0.3);
}
#login-container p, #register-container p { text-align:center; margin-top:15px; }
#login-container p a { color: teal; }
/* ---------- HOME PAGE - VERTICAL CONTAINERS WITH HORIZONTAL CATEGORY CARDS ---------- */
#home.active {
  min-height: calc(100vh - 80px);
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px 15px;
  gap: 20px;
}
.home-hero, .home-search-section, .home-categories {
  width: 100%;
  max-width: 1200px;
  background: rgba(255,255,255,0.2);
  border-radius: 20px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.8);
  border: 2px solid rgba(255,255,255,0.2);
  backdrop-filter: blur(10px);
  box-sizing: border-box;
  text-align: center;
}
.home-hero {
  padding: 40px 30px;
}
.home-search-section {
  padding: 30px;
}
.home-categories {
  padding: 30px 15px;
}
#home h2 {
  font-size: 2.8rem;
  margin: 20px 0;
  color:#2b2420;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
  font-family: Georgia, serif;
  letter-spacing: 1.5px;
}
#home p {
  font-size: 1.2rem;
  margin-bottom: 20px;
  color:#3b332d;
  line-height: 1.6;
  padding: 0 15px;
}
#search-row {
  display:flex;
  gap:15px;
  align-items:center;
  justify-content:center;
  margin:20px 0;
  flex-wrap: wrap;
}
#searchInput {
  padding: 18px 28px;
  width: 450px;
  max-width: 80vw;
  border-radius: 28px;
  border: 2px solid #cfc4b3;
  background: rgba(255,255,255,1);
  color: #2e2b26;
  box-shadow: 0 10px 30px rgba(0,0,0,0.15);
  font-size: 16px;
  transition: all 0.3s ease;
  box-sizing: border-box;
}
#searchInput:focus {
  outline: none;
  border-color: teal;
  box-shadow: 0 0 0 3px rgba(0,128,128,0.2), 0 10px 30px rgba(0,0,0,0.15);
  transform: scale(1.02);
}
#voice-btn {
  background: rgba(255,255,255,1);
  border:2px solid #cfc4b3;
  color:#3b332d;
  padding:16px;
  border-radius: 50%;
  cursor:pointer;
  font-weight:600;
  min-width: 60px;
  height: 60px;
  font-size: 22px;
  box-shadow: 0 8px 25px rgba(0,0,0,0.15);
  transition: all 0.3s;
}
#search-btn {
  background: rgba(255,255,255,1);
  border: 2px solid #cfc4b3;
  color: #3b332d;
  padding: 16px;
  border-radius: 50%;
  cursor: pointer;
  font-weight: 600;
  min-width: 60px;
  height: 60px;
  font-size: 22px;
  box-shadow: 0 8px 25px rgba(0,0,0,0.15);
  transition: all 0.3s;
}
#search-btn:hover {
  background: linear-gradient(45deg, teal, darkcyan);
  color: white;
  border-color: teal;
  transform: scale(1.08);
}
@media (max-width: 768px) {
  #search-btn {
    min-width: 55px;
    height: 55px;
    padding: 14px;
  }
}
@media (max-width: 480px) {
  #search-btn {
    width: 100%;
    height: 55px;
    border-radius: 15px;
  }
}
#voice-btn.listening {
  background: #ff6868;
  box-shadow: 0 0 25px rgba(255,104,104,0.8);
  color:#fff;
  transform: scale(1.08);
}
/* CATEGORY CARDS - HORIZONTAL LINE */
.category-options {
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
  gap: 15px;
  width: 100%;
  overflow-x: auto;
  padding: 0 10px;
  box-sizing: border-box;
}
.category-card {
  background: rgba(255,255,255,0.8);
  color: #2e2b26;
  border-radius: 20px;
  padding: 20px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 0 15px 40px rgba(0,0,0,0.16);
  border: 2px solid rgba(255,255,255,0.7);
  backdrop-filter: blur(10px);
  min-width: 180px;
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}
.category-card:hover {
  transform: translateY(-12px);
  box-shadow: 0 25px 60px rgba(0,0,0,0.25);
}
.category-card img {
  width: 100px;
  height: 100px;
  object-fit: cover;
  border-radius: 50%;
  margin-bottom: 12px;
  border: 4px solid #7aa6a6;
  padding: 5px;
  background: linear-gradient(135deg, #f3e5d0, #e7d9c8);
}
.category-card h3 {
  margin: 8px 0 0;
  font-size: 1.2rem;
}
/* ORDER MODAL (Updated Payment Modal to Order Modal) */
#orderModal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.7);
  z-index: 2000;
  justify-content: center;
  align-items: center;
}
#orderModal.show {
  display: flex;
}
.order-content {
  background: rgba(255,255,255,0.8);
  padding: 20px;
  border-radius: 20px;
  max-width: 400px;
  width: 90%;
  text-align: center;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  border: 2px solid rgba(255,255,255,0.8);
  backdrop-filter: blur(10px);
  position: relative;
}
.close-order-modal {
  position: absolute;
  top: px8;
  right: 12px;
  font-size: 20px;
  cursor: pointer;
  color: #2b2420;
}
.close-order-modal:hover {
  color: #d9534f;
}
.order-content h3 {
  color: #2b2420;
  margin-bottom: 20px;
  font-family: Georgia, serif;
}
.order-details input, .order-details textarea {
  width: 100%;
  padding: 8px;
  margin: 6px 0;
  border-radius: 8px;
  border: 1px solid #d4c8a8;
  background: rgba(255,255,255,0.9);
  box-sizing: border-box;
  font-size: 0.9rem;
}
.order-details textarea {
  resize: vertical;
  min-height: 80px;
}
.payment-options {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin: 20px 0;
}
.payment-option {
  padding: 8px;
  border: 2px solid #d4c8a8;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s;
  background: rgba(255,255,255,0.9);
}
.payment-option:hover, .payment-option.selected {
  border-color: teal;
  background: linear-gradient(45deg, rgba(0,128,128,0.1), rgba(0,139,139,0.1));
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(0,128,128,0.2);
}
.payment-option input[type="radio"] {
  margin-right: 10px;
}
#confirmOrder {
  background: linear-gradient(45deg, #28a745, #20c997);
  color: white;
  border: none;
  padding: 8px 20px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  margin-top: 15px;
}
#confirmOrder:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(40,167,69,0.3);
}
/* Search not found message */
#search-not-found, #products-search-not-found {
  display: none;
  background: rgba(255,255,255,0.8);
  border-radius: 20px;
  padding: 30px;
  text-align: center;
  margin: 30px auto;
  max-width: 700px;
  box-shadow: 0 15px 40px rgba(0,0,0,0.18);
  border: 2px solid rgba(255,255,255,0.7);
}
#search-not-found.show, #products-search-not-found.show {
  display: block;
  animation: fadeIn 0.5s ease-in;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
#search-not-found h3, #products-search-not-found h3 {
  color: #d9534f;
  margin: 0 0 10px 0;
  font-family: Georgia, serif;
}
#search-not-found p, #products-search-not-found p {
  color: #6c757d;
  margin: 0;
}
#products-search-not-found button {
  background: linear-gradient(45deg, teal, darkcyan);
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  cursor: pointer;
  margin-top: 10px;
}
/* ---------- PRODUCTS GRID - SMALLER WITH MORE SPACING ---------- */
.products-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 30px;
  padding: 20px;
  position: relative;
  max-width: 1200px;
  margin: 0 auto;
  min-height: calc(100vh - 200px);
}
.card {
  background: rgba(255,255,255,0.8);
  border: none;
  border-radius: 15px;
  padding: 15px;
  text-align: center;
  box-shadow: 0 10px 35px rgba(0,0,0,0.12);
  transition: all 0.3s ease;
  border: 1px solid rgba(255,255,255,0.4);
  backdrop-filter: blur(8px);
  position: relative;
  z-index: 2;
  display: flex;
  flex-direction: column;
  max-height: 320px;
  min-height: 280px;
}
.card:hover {
  transform: translateY(-8px);
  box-shadow: 0 20px 50px rgba(0,0,0,0.2);
}
.card img {
  width: 100%;
  height: 140px;
  object-fit: cover;
  object-position: center;
  border-radius: 12px;
  margin-bottom: 10px;
  background: linear-gradient(135deg, #f3e5d0, #e7d9c8);
  padding: 5px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}
.card h3 {
  color: #2b2420;
  margin: 6px 0;
  font-size: 0.95rem;
  flex-grow: 1;
}
.card p {
  color: #5a3d2e;
  font-weight: 600;
  font-size: 0.9rem;
  margin-bottom: 8px;
}
.card input {
  width: 60px;
  padding: 5px;
  border: 1px solid #d4c8a8;
  border-radius: 6px;
  margin-bottom: 8px;
}
.card button {
  margin: 3px;
  padding: 7px 12px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  font-size: 0.85rem;
  transition: all 0.2s;
}
.card button:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}
.card button:first-of-type {
  background: linear-gradient(45deg, #6aa19a, #5a9a8a);
  color: white;
}
.card button:first-of-type:hover {
  background: linear-gradient(45deg, #568a85, #4a7a75);
}
.card button:last-of-type {
  background: linear-gradient(45deg, #d97a2a, #c66a1a);
  color: white;
}
.card button:last-of-type:hover {
  background: linear-gradient(45deg, #b35d20, #a54d10);
}
/* ---------- Cart / Orders / Profile / Contact / About ---------- */
#cart-items,
.orders-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
  padding: 16px; /* space inside the box */
  border: 2px solid #ddd; /* border for box look */
  border-radius: 10px; /* rounded corners */
  background-color: #fff; /* white background */
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); /* subtle shadow */
  width: fit-content; /* adjusts width to content */
  height: fit-content; /* adjusts height to content */
  max-width: 100%; /* prevents overflow on smaller screens */
  margin: 10px auto; /* centers it horizontally */
  align-items:center;
}
.cart-item, .order-item {
  background:rgba(255,255,255,0.8);
  border:1px solid rgba(0,0,0,0.1);
  border-radius:8px;
  padding:12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  box-shadow:0 2px 10px rgba(0,0,0,0.08);
  flex-wrap: wrap;
  gap: 10px;
}
.cart-item button {
  background:linear-gradient(45deg, crimson, darkred);
  color:white;
  border:none;
  padding:6px 12px;
  border-radius:6px;
  cursor:pointer;
}
.cart-item button:hover { background: darkred; }
.order-item button.cancel-order {
  background:linear-gradient(45deg, #d9534f, #c9302c);
  color:white;
  border:none;
  padding:6px 12px;
  border-radius:6px;
  cursor:pointer;
}
.order-item button.cancel-order:hover {
  background: #c9302c;
}
#cart-total {
  margin-top: 16px;
  font-size: 1.2rem;
  font-weight: 700;
  color: #2b2420;
  text-align: center;
  padding: 15px;
  background: #fff;
  border: 2px solid #ddd; /* same border as cart-items */
  border-radius: 10px; /* rounded corners */
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); /* subtle shadow */
  width: fit-content; /* adjusts to content */
  height: fit-content;
  max-width: 100%; /* responsive */
  margin-left: auto;
  margin-right: auto; /* centers horizontally */
}
#cart-buy-now {
  background: linear-gradient(45deg, #d97a2a, #c66a1a);
  color: white;
  border: none;
  padding: 12px 20px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  margin: 10px auto;
  display: block;
}
#cart-buy-now:hover {
  background: linear-gradient(45deg, #b35d20, #a54d10);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}
#orders {
  max-width: 90vw;
  margin: 0 auto;
  padding: 25px;
}
#orders h2 {
  text-align: center;
  color: #2b2420;
  font-family: Georgia, serif;
  font-size: 1.6rem;
  margin-bottom: 20px;
}
.order-item p {
  margin: 5px 0;
  color: #3b332d;
}
#profile {
  max-width:40vw;
  margin:0 auto;
  padding:25px;
  background:rgba(255,255,255,0.8);
  border-radius:10px;
  box-shadow:0 8px 30px rgba(0,0,0,0.15);
  backdrop-filter: blur(10px);
  border:1px solid rgba(255,255,255,0.3);
}
#profile h2 {
  margin-top:0;
  color:#2b2420;
  text-align: center;
  font-family: Georgia, serif;
  font-size: 1.5rem;
}
.profile-row {
  display:flex;
  gap:16px;
  align-items:flex-start;
  flex-wrap: wrap;
  margin-bottom: 20px;
}
.profile-row img {
  width:100px;
  height:100px;
  object-fit:cover;
  border-radius:12px;
  border:3px solid #d4c8a8;
  flex-shrink: 0;
}
.profile-row div { flex:1; min-width: 250px; }
.profile-row input, #profile textarea {
  width:100%;
  padding:10px;
  border-radius:8px;
  border:1px solid #cfc4b3;
  background:rgba(255,255,255,0.9);
  box-sizing: border-box;
  margin: 5px 0;
}
#saveProfileBtn, #deleteProfileBtn {
  padding:12px 20px;
  border-radius:8px;
  border:none;
  cursor:pointer;
  font-weight:700;
  font-size: 1rem;
  margin: 5px;
}
#saveProfileBtn {
  background:linear-gradient(45deg, #6aa19a, #5a9a8a);
  color:white;
}
#deleteProfileBtn {
  background:linear-gradient(45deg, crimson, darkred);
  color:white;
}
#contact {
  max-width: 600px; /* Changed from 90vw to 600px to reduce container size */
  margin: 0 auto;
}
#contact textarea {
  width: 100%;
  padding: 10px;
  border-radius: 10px;
  border: 1px solid #cfc4b3;
  min-height: 150px;
  resize: vertical;
  font-size: 1rem;
  font-family: inherit;
  background: rgba(255,255,255,0.8);
  color: #2b2420;
  box-sizing: border-box;
  margin: 10px 0;
}
#contact input {
  width: 100%;
  padding: 12px;
  border-radius: 8px;
  border: 1px solid #cfc4b3;
  background: rgba(255,255,255,0.8);
  box-sizing: border-box;
  margin: 10px 0;
}
#contact button {
  width: 100%;
  padding: 12px;
  background: linear-gradient(45deg, teal, darkcyan);
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
}
#contact h2 {
  font-size: 1.6rem;
  margin-bottom: 12px;
  text-align: center;
  color: #2b2420;
  font-family: Georgia, serif;
}
#about {
  max-width:90vw;
  margin:0 auto;
  background:rgba(255,255,255,0.8);
  padding:25px;
  border-radius:15px;
  box-shadow:0 4px 20px rgba(0,0,0,0.1);
}
#about h2 {
  text-align:center;
  color:#2b2420;
  font-family:Georgia,serif;
}
#about p {
  line-height:1.6;
  color:#3b332d;
  text-align:justify;
}
/* ========== MOBILE RESPONSIVE ========== */
@media (max-width:768px){
  header { padding:10px 12px; }
  header h2 { font-size:1rem; }
  nav { gap:2px; }
  nav a, .logout-btn { font-size:0.8rem; margin:1px 2px; padding:2px 4px; }
  main { padding:70px 10px 20px; }
  .home-hero, .home-search-section, .home-categories {
    padding: 25px 20px;
    margin-bottom: 15px;
    max-width: 95vw;
  }
  #home h2 { font-size: 2.2rem; }
  #home p { font-size: 1.1rem; padding: 0 10px; }
  #searchInput {
    width: 100%;
    max-width: none;
    padding: 16px 22px;
  }
  #voice-btn {
    min-width: 55px;
    height: 55px;
    padding: 14px;
  }
  .category-options {
    flex-wrap: nowrap;
    gap: 10px;
    padding: 0 5px;
  }
  .category-card {
    min-width: 140px;
    padding: 15px;
  }
  .category-card img {
    width: 80px;
    height: 80px;
  }
  .category-card h3 { font-size: 1rem; }
  .products-grid {
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 25px;
    padding: 15px;
  }
  .card {
    padding: 12px;
    max-height: 300px;
    min-height: 260px;
  }
  .card img { height: 120px; }
  .order-content {
    padding: 25px;
    margin: 20px;
  }
}
@media (max-width:480px){
  .home-hero, .home-search-section, .home-categories {
    padding: 20px 15px;
    margin-bottom: 10px;
  }
  #home h2 { font-size: 1.8rem; }
  #search-row {
    flex-direction:column;
    align-items:stretch;
    gap:15px;
    padding: 20px;
  }
  #searchInput { padding: 15px 20px; }
  #voice-btn {
    width: 100%;
    height: 55px;
    border-radius: 15px;
  }
  .category-options {
    flex-wrap: nowrap;
    gap: 8px;
  }
  .category-card {
    min-width: 120px;
    padding: 12px;
  }
  .category-card img {
    width: 70px;
    height: 70px;
  }
  .products-grid {
    grid-template-columns: 1fr;
    gap: 25px;
  }
  .card {
    max-height: 280px;
    min-height: 240px;
  }
  .card img { height: 100px; }
}
.search-input-wrapper {
  position: relative;
  flex-grow: 1;
  max-width: 500px;
}
#searchInput {
  width: 100%;
  padding-right: 50px; /* Increased to accommodate larger button */
}
#clear-btn {
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%) scale(1);
  background: rgba(255,255,255,0.8); /* Slight background for visibility */
  border: none;
  color: #2b2420;
  font-size: 20px; /* Larger for prominence */
  font-weight: bold;
  cursor: pointer;
  padding: 8px;
  border-radius: 50%; /* Circular button */
  width: 32px;
  height: 32px;
  display: none;
  transition: transform 0.2s ease, color 0.2s ease, background 0.2s ease;
}
#clear-btn:hover {
  color: #ff4d4d;
  background: rgba(255,255,255,1);
  transform: translateY(-50%) scale(1.1); /* Slight scale-up on hover */
}
@media (max-width: 768px) {
  #clear-btn {
    font-size: 18px;
    right: 10px;
    width: 28px;
    height: 28px;
    padding: 6px;
  }
}
@media (max-width: 480px) {
  .search-input-wrapper {
    width: 100%;
  }
  #clear-btn {
    font-size: 16px;
    width: 24px;
    height: 24px;
    padding: 4px;
  }
}
#clear-btn:hover {
  color: #ff4d4d;
}
@media (max-width: 768px) {
  #clear-btn {
    font-size: 16px;
    right: 8px;
  }
}
@media (max-width: 480px) {
  .search-input-wrapper {
    width: 100%;
  }
  #clear-btn {
    font-size: 14px;
  }
}
</style>
</head>
<body>
<!-- Notification -->
<div id="notification"></div>
<!-- Order Modal (Replaces Payment Modal) -->
<div id="orderModal">
  <div class="order-content">
    <span class="close-order-modal" onclick="hideOrderModal()">&times;</span>
    <h3>üõí Place Your Order</h3>
    <div class="order-details">
      <label style="display:block; margin:10px 0 5px; font-weight:600;">Full Name</label>
      <input type="text" id="orderName" placeholder="Enter your full name" required>
      <label style="display:block; margin:10px 0 5px; font-weight:600;">Mobile Number</label>
      <input type="tel" id="orderMobile" placeholder="Enter your mobile number" required>
      <label style="display:block; margin:10px 0 5px; font-weight:600;">Shipping Address</label>
      <textarea id="orderAddress" placeholder="Enter your full shipping address" required></textarea>
      <label style="display:block; margin:10px 0 5px; font-weight:600;">Pincode</label>
      <input type="text" id="orderPincode" placeholder="Enter your pincode" required>
    </div>
    <div class="payment-options">
      <label class="payment-option">
        <input type="radio" name="paymentMethod" value="COD" checked>
        üí∞ Cash on Delivery
      </label>
      <label class="payment-option">
        <input type="radio" name="paymentMethod" value="UPI">
        üì± UPI / Google Pay / PhonePe
      </label>
      <label class="payment-option">
        <input type="radio" name="paymentMethod" value="CARD">
        üí≥ Credit/Debit Card
      </label>
      <label class="payment-option">
        <input type="radio" name="paymentMethod" value="NETBANKING">
        üè¶ Net Banking
      </label>
    </div>
    <button id="confirmOrder">‚úÖ Confirm & Place Order</button>
  </div>
</div>
<!-- Login/Register Forms -->
<section id="login-container">
  <h2>Login</h2>
  <form id="loginForm">
    <input type="email" id="email" placeholder="Email" required>
    <input type="password" id="password" placeholder="Password" required>
    <button type="submit">Login</button>
  </form>
  <p>Don't have an account? <a href="#" onclick="showRegister()">Register</a></p>
</section>
<section id="register-container" style="display:none;">
  <h2>Register</h2>
  <form id="registerForm">
    <input type="email" id="regEmail" placeholder="Email" required>
    <input type="password" id="regPassword" placeholder="Password" required>
    <button type="submit">Register</button>
  </form>
  <p>Already have an account? <a href="#" onclick="showLogin()">Login</a></p>
</section>
<!-- Store Content -->
<div id="store-content" style="display:none;">
<header>
  <h2>üï∞Ô∏è Vintage Store</h2>
  <nav>
    <a href="#" onclick="showPage('home'); return false;">Home</a>
    <a href="#" onclick="showPage('products'); return false;">Products</a>
    <a href="#" onclick="showPage('cart'); return false;">Cart </a>
    <a href="#" onclick="showPage('orders'); return false;">Orders</a>
    <a href="#" onclick="showPage('profile'); return false;">Profile</a>
    <a href="#" onclick="showPage('about'); return false;">About</a>
    <a href="#" onclick="showPage('contact'); return false;">Contact</a>
    <span class="logout-btn" onclick="logout()">Logout</span>
  </nav>
</header>
<main>
  <!-- Home - VERTICAL CONTAINERS WITH HORIZONTAL CATEGORY CARDS -->
  <section id="home" class="active">
    <div class="home-hero">
      <h2>Welcome to Vintage Store</h2>
      <p>Discover timeless treasures and classic pieces that tell stories of elegance and craftsmanship</p>
      <div id="search-row">
  <div class="search-input-wrapper">
    <input type="text" id="searchInput" placeholder="Search vintage treasures..." />
    <button id="clear-btn" title="Clear search" style="display: none;">‚úñ</button>
  </div>
  <button id="search-btn" title="Search">üîç</button>
  <button id="voice-btn" title="Voice search">üé§</button>
</div>
      <div id="search-not-found">
        <h3>üîç No Products Found</h3>
        <p>Sorry, we couldn't find any vintage treasures matching "<span id="searchTerm"></span>". Try different keywords or browse our categories!</p>
      </div>
    </div>
    <div class="home-categories">
        <h2>CATOGERY</h2>
      <div class="category-options">
       
        <div class="category-card" onclick="filterCategory('watches')">
          <img src="https://www.levyjewelers.com/blog/upload/blog/1712690548_post_image.jpg" alt="Watches">
          <h3>üïê Watches</h3>
        </div>
        <div class="category-card" onclick="filterCategory('clocks')">
          <img src="https://www.mayfairgallery.com/media/wysiwyg/clockface_main_image.jpg" alt="Clocks">
          <h3>‚è∞ Clocks</h3>
        </div>
        <div class="category-card" onclick="filterCategory('lights')">
          <img src="https://m.media-amazon.com/images/I/61y0NaPM6IL._UF894,1000_QL80_.jpg" alt="Lights">
          <h3>üí° Lights</h3>
        </div>
        <div class="category-card" onclick="filterCategory('jewelry')">
          <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ2QPLomvn6SebJgx6byNUYGjb5oq_d4a2g2g&s" alt="Jewelry">
          <h3>üíç Jewelry</h3>
        </div>
        <div class="category-card" onclick="filterCategory('decor')">
          <img src="https://i.etsystatic.com/19608749/r/il/d3f45b/5348153606/il_570xN.5348153606_ll8n.jpg" alt="Decor">
          <h3>üè∫ Decor</h3>
        </div>
        <div class="category-card" onclick="filterCategory('furniture')">
          <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSf24LbQG1qaCpUeuxWaLDk6-mTWvRj2sjZnA&s" alt="Furniture">
          <h3>ü™ë Furniture</h3>
        </div>
      </div>
    </div>
  </section>
  <!-- Products - SMALLER CARDS WITH MORE SPACING -->
  <section id="products">
    <h2 style="text-align:center; margin:10px 0; color:#2b2420;">Our Vintage Collection</h2>
    <div id="products-search-not-found">
      <h3>üîç No Products Found</h3>
      <p>Sorry, we couldn't find any vintage treasures matching your search. Try different keywords!</p>
      <button onclick="resetProductDisplay()">Browse All Products</button>
    </div>
    <div id="productsGrid" class="products-grid">
      <!-- WATCHES -->
      <div class="card" data-name="Vintage Pocket Watch" data-price="1800" data-category="watches">
        <img src="https://thumbs.dreamstime.com/b/vintage-pocket-watch-antique-35091798.jpg" alt="Vintage Pocket Watch">
        <h3>Vintage Pocket Watch</h3>
        <p>Price: ‚Çπ1800</p>
        <label>Qty: <input type="number" value="1" min="1" max="10"></label>
        <div>
          <button onclick="addToCart(this)">Add to Cart</button>
          <button onclick="buyProduct(this)">Buy Now</button>
        </div>
      </div>
      <div class="card" data-name="Classic Wristwatch" data-price="2500" data-category="watches">
        <img src="https://m.media-amazon.com/images/I/71ZsdaCEMYL._UY1000_.jpg" alt="Classic Wristwatch">
        <h3>Classic Wristwatch</h3>
        <p>Price: ‚Çπ2500</p>
        <label>Qty: <input type="number" value="1" min="1" max="10"></label>
        <div>
          <button onclick="addToCart(this)">Add to Cart</button>
          <button onclick="buyProduct(this)">Buy Now</button>
        </div>
      </div>
      <div class="card" data-name="Gold Pocket Watch" data-price="3500" data-category="watches">
        <img src="https://eragem.com/media/catalog/product/cache/e4507427afc9429093d76362a19cfadc/7/4/74596a.jpg" alt="Gold Pocket Watch">
        <h3>Gold Pocket Watch</h3>
        <p>Price: ‚Çπ3500</p>
        <label>Qty: <input type="number" value="1" min="1" max="10"></label>
        <div>
          <button onclick="addToCart(this)">Add to Cart</button>
          <button onclick="buyProduct(this)">Buy Now</button>
        </div>
      </div>
      <!-- CLOCKS -->
      <div class="card" data-name="Antique Wall Clock" data-price="2800" data-category="clocks">
        <img src="https://rukminim2.flixcart.com/image/480/640/kvpklu80/wall-decoration/9/l/n/metal-vintage-round-ship-antique-wall-clock-with-showpiece-original-imag8jyaa6k5hbtw.jpeg?q=90" alt="Antique Wall Clock">
        <h3>Antique Wall Clock</h3>
        <p>Price: ‚Çπ2800</p>
        <label>Qty: <input type="number" value="1" min="1" max="10"></label>
        <div>
          <button onclick="addToCart(this)">Add to Cart</button>
          <button onclick="buyProduct(this)">Buy Now</button>
        </div>
      </div>
      <div class="card" data-name="Vintage Mantel Clock" data-price="2200" data-category="clocks">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTepuTnmz7qsAelBdCVD0AiYElB56EMHy4Gbg&s" alt="Vintage Mantel Clock">
        <h3>Vintage Mantel Clock</h3>
        <p>Price: ‚Çπ2200</p>
        <label>Qty: <input type="number" value="1" min="1" max="10"></label>
        <div>
          <button onclick="addToCart(this)">Add to Cart</button>
          <button onclick="buyProduct(this)">Buy Now</button>
        </div>
      </div>
      <div class="card" data-name="Antique Grandfather Clock" data-price="5000" data-category="clocks">
        <img src="https://www.suburbanclock.com/cdn/shop/files/s-l1600_1800x1800_6421374b-eab1-4ee0-921e-467854ab0e63_900x.jpg?v=1722656195" alt="Antique Grandfather Clock">
        <h3>Antique Grandfather Clock</h3>
        <p>Price: ‚Çπ5000</p>
        <label>Qty: <input type="number" value="1" min="1" max="5"></label>
        <div>
          <button onclick="addToCart(this)">Add to Cart</button>
          <button onclick="buyProduct(this)">Buy Now</button>
        </div>
      </div>
      <!-- LIGHTS -->
      <div class="card" data-name="Vintage Chandelier" data-price="4500" data-category="lights">
        <img src="https://m.media-amazon.com/images/I/71JbfQ0RUyL.jpg" alt="Vintage Chandelier">
        <h3>Vintage Chandelier</h3>
        <p>Price: ‚Çπ4500</p>
        <label>Qty: <input type="number" value="1" min="1" max="5"></label>
        <div>
          <button onclick="addToCart(this)">Add to Cart</button>
          <button onclick="buyProduct(this)">Buy Now</button>
        </div>
      </div>
      <div class="card" data-name="Vintage Desk Lamp" data-price="2000" data-category="lights">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQDs4_QpCzTX8xUH9CMGUc5fszG2EnnMYLBJw&s" alt="Vintage Desk Lamp">
        <h3>Vintage Desk Lamp</h3>
        <p>Price: ‚Çπ2000</p>
        <label>Qty: <input type="number" value="1" min="1" max="10"></label>
        <div>
          <button onclick="addToCart(this)">Add to Cart</button>
          <button onclick="buyProduct(this)">Buy Now</button>
        </div>
      </div>
      <!-- JEWELRY -->
      <div class="card" data-name="Vintage Necklace" data-price="1200" data-category="jewelry">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRGLk50KOSM2bGylljSKB5BDGYO1nC8u4o4Cw&s" alt="Vintage Necklace">
        <h3>Vintage Necklace</h3>
        <p>Price: ‚Çπ1200</p>
        <label>Qty: <input type="number" value="1" min="1" max="10"></label>
        <div>
          <button onclick="addToCart(this)">Add to Cart</button>
          <button onclick="buyProduct(this)">Buy Now</button>
        </div>
      </div>
      <div class="card" data-name="Antique Brooch" data-price="900" data-category="jewelry">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSNknYiAyUeLx3fP402H_DpBKESu5YOgdXBBw&s" alt="Antique Brooch">
        <h3>Antique Brooch</h3>
        <p>Price: ‚Çπ900</p>
        <label>Qty: <input type="number" value="1" min="1" max="10"></label>
        <div>
          <button onclick="addToCart(this)">Add to Cart</button>
          <button onclick="buyProduct(this)">Buy Now</button>
        </div>
      </div>
      <div class="card" data-name="Vintage Pearl Ring" data-price="1500" data-category="jewelry">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSyinCd4cuWiXkxHYZGrf0uP_kPyRpxCILPww&s" alt="Vintage Pearl Ring">
        <h3>Vintage Pearl Ring</h3>
        <p>Price: ‚Çπ1500</p>
        <label>Qty: <input type="number" value="1" min="1" max="10"></label>
        <div>
          <button onclick="addToCart(this)">Add to Cart</button>
          <button onclick="buyProduct(this)">Buy Now</button>
        </div>
      </div>
      <!-- DECOR -->
      <div class="card" data-name="Antique Vase" data-price="1500" data-category="decor">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQFr9rCE0sPZV54YEam5RHLxeRc5ht2d9gyCQ&s" alt="Antique Vase">
        <h3>Antique Vase</h3>
        <p>Price: ‚Çπ1500</p>
        <label>Qty: <input type="number" value="1" min="1" max="10"></label>
        <div>
          <button onclick="addToCart(this)">Add to Cart</button>
          <button onclick="buyProduct(this)">Buy Now</button>
        </div>
      </div>
      <div class="card" data-name="Vintage Mirror" data-price="3200" data-category="decor">
        <img src="https://i.etsystatic.com/9272694/r/il/ef1fe0/1146621789/il_570xN.1146621789_mpmk.jpg" alt="Vintage Mirror">
        <h3>Vintage Mirror</h3>
        <p>Price: ‚Çπ3200</p>
        <label>Qty: <input type="number" value="1" min="1" max="5"></label>
        <div>
          <button onclick="addToCart(this)">Add to Cart</button>
          <button onclick="buyProduct(this)">Buy Now</button>
        </div>
      </div>
      <!-- FURNITURE -->
      <div class="card" data-name="Vintage Chair" data-price="8500" data-category="furniture">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT3hfToP07ClfJQz1YgC3zrvaUxgZSoKvWp_A&s" alt="Vintage Chair">
        <h3>Vintage Chair</h3>
        <p>Price: ‚Çπ8500</p>
        <label>Qty: <input type="number" value="1" min="1" max="5"></label>
        <div>
          <button onclick="addToCart(this)">Add to Cart</button>
          <button onclick="buyProduct(this)">Buy Now</button>
        </div>
      </div>
      <div class="card" data-name="Antique Desk" data-price="12500" data-category="furniture">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTKL3VEn6oOoLUfY5lWok7uxYSSW6L6C6uxGA&s" alt="Antique Desk">
        <h3>Antique Desk</h3>
        <p>Price: ‚Çπ12500</p>
        <label>Qty: <input type="number" value="1" min="1" max="3"></label>
        <div>
          <button onclick="addToCart(this)">Add to Cart</button>
          <button onclick="buyProduct(this)">Buy Now</button>
        </div>
      </div>
    </div>
  </section>
  <!-- Cart -->
  <section id="cart">
    <h2 style="text-align:center; color:#2b2420;">Your Cart</h2>
    <div id="cart-items"></div>
    <p id="cart-total">Total: ‚Çπ0</p>
    <button id="cart-buy-now" style="display:none;">Buy Now</button>
  </section>
  <!-- Orders -->
  <section id="orders">
    <h2>Your Orders</h2>
    <div id="orders-list" class="orders-list"></div>
  </section>
  <!-- Profile -->
  <section id="profile">
    <h2>Your Profile</h2>
    <div class="profile-row">
      <img id="profilePicPreview" src="https://via.placeholder.com/100x100.png?text=üë§" alt="Profile Pic">
      <div>
        <label style="display:block; margin-bottom:5px; font-weight:600;">Display Name</label>
        <input id="profileDisplayName" placeholder="Enter your display name">
        <label style="display:block; margin:15px 0 5px 0; font-weight:600;">Email (cannot be changed)</label>
        <p id="profileEmail" style="padding:10px; background:#f5f5f5; border-radius:8px;">Loading...</p>
        <label style="display:block; margin:15px 0 5px 0; font-weight:600;">Profile Image URL</label>
        <input id="profilePhotoURL" placeholder="https://example.com/your-image.jpg">
        <small style="color:#666; display:block; margin-top:5px;">Paste a direct image URL or leave blank</small>
        <label style="display:block; margin:15px 0 5px 0; font-weight:600;">Mobile Number</label>
        <input id="profileMobile" placeholder="Enter your mobile number (required for orders)">
        <label style="display:block; margin:15px 0 5px 0; font-weight:600;">Shipping Address</label>
        <textarea id="profileAddress" placeholder="Enter your full shipping address (required for orders)" rows="4"></textarea>
        <label style="display:block; margin:15px 0 5px 0; font-weight:600;">Pincode</label>
        <input id="profilePincode" placeholder="Enter your pincode (required for orders)">
      </div>
    </div>
    <div style="text-align:center;">
      <button id="saveProfileBtn">üíæ Save Profile</button>
      <button id="deleteProfileBtn">üóëÔ∏è Delete Profile Data</button>
    </div>
  </section>
  <!-- About -->
  <section id="about">
    <h2>About Vintage Store</h2>
    <p style="line-height:1.6; color:#3b332d; text-align:justify;">
      Step into <strong>Vintage Store</strong>, where every piece tells a timeless story of craftsmanship and elegance.
      From exquisite watches and antique clocks to stunning lighting fixtures and heirloom jewelry, we curate
      authentic vintage treasures that bring the charm of yesteryears into modern living.
    </p>
    <p style="line-height:1.6; color:#3b332d; text-align:justify;">
      Each item in our collection is carefully handpicked for its historical significance, superior quality,
      and unique character. We offer secure online payments, reliable shipping, and authentic vintage pieces
      that become cherished heirlooms for generations.
    </p>
    <p style="text-align:center; font-style:italic; color:#5a3d2e;">
      <em>"Timeless treasures that never fade ‚Äî because true elegance endures."</em>
    </p>
  </section>
  <!-- Contact -->
  <section id="contact">
    <h2>Contact Us</h2>
    <form id="contactForm">
      <input type="text" id="contactName" placeholder="Your Full Name" required>
      <input type="email" id="contactEmail" placeholder="Your Email Address" required>
      <textarea id="contactMessage" placeholder="Tell us about your query or vintage treasure you're looking for..." required></textarea>
      <button type="submit">üìß Send Message</button>
      <p style="text-align:center; margin-top:15px;">Or email us directly at <strong>support@vintagestore.com</strong></p>
      <p id="contactFeedback" style="color:green; font-weight:bold; text-align:center; display:none;"></p>
    </form>
  </section>
</main>
</div>
<script>
/* Firebase config */
const firebaseConfig = {
  apiKey: "AIzaSyA8xmP1860A5XtWzlFcIWqY1jSl3dN2cME",
  authDomain: "vintage-products-ce5dc.firebaseapp.com",
  projectId: "vintage-products-ce5dc",
  storageBucket: "vintage-products-ce5dc.appspot.com",
  messagingSenderId: "20067314983",
  appId: "1:20067314983:web:5d209cf0775937b532cd02",
  measurementId: "G-L8P96QDLC0"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
let currentProduct = null;
let currentCartItems = null;
let currentSearchTerm = '';
let searchTimeout;
/* Notification Function */
function showNotification(message) {
  const notification = document.getElementById('notification');
  notification.textContent = message;
  notification.classList.add('show');
  setTimeout(() => {
    notification.classList.remove('show');
  }, 3000);
}
/* ORDER MODAL FUNCTIONS */
async function showOrderModal(productData, cartItems) {
  currentProduct = productData;
  currentCartItems = cartItems;
  const modal = document.getElementById('orderModal');
  const nameInput = document.getElementById('orderName');
  const mobileInput = document.getElementById('orderMobile');
  const addressInput = document.getElementById('orderAddress');
  const pincodeInput = document.getElementById('orderPincode');
  // Auto-fill from profile
  const user = auth.currentUser;
  if (user) {
    try {
      const profileDoc = await db.collection('users').doc(user.uid).get();
      if (profileDoc.exists) {
        const profile = profileDoc.data();
        nameInput.value = profile.displayName || '';
        mobileInput.value = profile.mobileNumber || '';
        addressInput.value = profile.address || '';
        pincodeInput.value = profile.pincode || '';
      }
    } catch (error) {
      console.error('Error loading profile for order:', error);
    }
  }
  modal.classList.add('show');
}
function hideOrderModal() {
  document.getElementById('orderModal').classList.remove('show');
  currentProduct = null;
  currentCartItems = null;
}
document.getElementById('confirmOrder').addEventListener('click', async () => {
  const selectedPayment = document.querySelector('input[name="paymentMethod"]:checked');
  if (!selectedPayment) {
    showNotification('‚ùå Please select a payment method!');
    return;
  }
  const name = document.getElementById('orderName').value.trim();
  const mobile = document.getElementById('orderMobile').value.trim();
  const address = document.getElementById('orderAddress').value.trim();
  const pincode = document.getElementById('orderPincode').value.trim();
  const paymentMethod = selectedPayment.value;
  if (!name || !mobile || !address || !pincode) {
    showNotification('‚ùå Please fill in all required fields (name, mobile, address, pincode).');
    return;
  }
  try {
    document.getElementById('confirmOrder').textContent = 'Processing...';
    document.getElementById('confirmOrder').disabled = true;
    let items = [];
    let total = 0;
    if (currentCartItems) {
      // Process cart purchase
      items = currentCartItems.map(item => {
        const itemTotal = item.price * item.qty;
        total += itemTotal;
        return {
          name: item.name,
          price: item.price,
          quantity: item.qty,
          subtotal: itemTotal,
          image: item.image,
          category: item.category
        };
      });
    } else if (currentProduct) {
      // Process single product purchase
      const itemTotal = currentProduct.price * currentProduct.qty;
      total = itemTotal;
      items = [{
        name: currentProduct.name,
        price: currentProduct.price,
        quantity: currentProduct.qty,
        subtotal: itemTotal,
        image: currentProduct.image,
        category: currentProduct.category
      }];
    } else {
      showNotification('‚ùå No product or cart items selected. Please try again.');
      return;
    }
    const user = auth.currentUser;
    if (!user) {
      throw new Error('You must be logged in to place an order. Please log in and try again.');
    }
    const orderRef = await db.collection('orders').add({
      userId: user.uid,
      items: items,
      total: total,
      paymentMethod: paymentMethod,
      name: name,
      mobile: mobile,
      address: address,
      pincode: pincode,
      email: user.email,
      orderDate: firebase.firestore.Timestamp.now(),
      status: 'pending'
    });
    let productsList = items.map(item => `Product: ${item.name}, Qty: ${item.quantity}, Subtotal: ‚Çπ${item.subtotal}`).join('\n');
    showNotification(`‚úÖ Order Placed Successfully!\nOrder ID: ${orderRef.id}\n${productsList}\nTotal: ‚Çπ${total}\nPayment Method: ${getPaymentMethodName(paymentMethod)}\nüéâ Thank you for ordering!`);
    if (currentCartItems) {
      await clearCartInFirebase();
      if (document.getElementById('cart').classList.contains('active')) {
        await renderCart();
      }
    }
    if (document.getElementById('orders').classList.contains('active')) {
      await loadOrders();
    }
    hideOrderModal();
  } catch (error) {
    console.error('Error placing order:', error);
    showNotification('‚ùå Failed to place order: ' + error.message);
  } finally {
    document.getElementById('confirmOrder').textContent = '‚úÖ Confirm & Place Order';
    document.getElementById('confirmOrder').disabled = false;
  }
});
function getPaymentMethodName(method) {
  const methods = {
    'COD': 'Cash on Delivery',
    'UPI': 'UPI Payment',
    'CARD': 'Credit/Debit Card',
    'NETBANKING': 'Net Banking'
  };
  return methods[method] || method;
}
/* Cart Functions - Firebase Integration */
async function loadCart() {
  const user = auth.currentUser;
  if (!user) {
    return [];
  }
  try {
    const doc = await db.collection('carts').doc(user.uid).get();
    return doc.exists ? doc.data().items || [] : [];
  } catch (error) {
    console.error('Error loading cart:', error);
    return [];
  }
}
async function saveCartToFirebase(items) {
  const user = auth.currentUser;
  if (!user) return;
  try {
    await db.collection('carts').doc(user.uid).set({
      items: items,
      lastUpdated: firebase.firestore.Timestamp.now()
    });
    console.log('Cart saved to Firebase');
  } catch (error) {
    console.error('Error saving cart:', error);
  }
}
async function clearCartInFirebase() {
  const user = auth.currentUser;
  if (!user) return;
  try {
    await db.collection('carts').doc(user.uid).delete();
    console.log('Cart cleared in Firebase');
  } catch (error) {
    console.error('Error clearing cart:', error);
  }
}
function addToCart(button) {
  const card = button.closest(".card");
  const name = card.dataset.name;
  const price = parseInt(card.dataset.price);
  const qty = parseInt(card.querySelector("input").value) || 1;
  const image = card.querySelector("img").src;
  const category = card.dataset.category;
  loadCart().then(async (cart) => {
    const existing = cart.find(item => item.name === name);
    if (existing) {
      existing.qty += qty;
    } else {
      cart.push({ name, price, qty, image, category });
    }
    await saveCartToFirebase(cart);
    showNotification(`üõí ${name} (${qty}x) added to cart!`);
    if (document.getElementById('cart').classList.contains('active')) {
      await renderCart();
    }
  });
}
function removeFromCart(index) {
  loadCart().then(async (cart) => {
    const itemName = cart[index].name;
    cart.splice(index, 1);
    await saveCartToFirebase(cart);
    showNotification(`üóëÔ∏è ${itemName} removed from cart.`);
    if (document.getElementById('cart').classList.contains('active')) {
      await renderCart();
    }
  });
}
function buyCartItems() {
  loadCart().then(cart => {
    if (cart.length === 0) {
      showNotification('‚ùå Your cart is empty. Add items to purchase.');
      return;
    }
    showOrderModal(null, cart);
  });
}
async function renderCart() {
  const cartDiv = document.getElementById("cart-items");
  const buyNowBtn = document.getElementById("cart-buy-now");
  cartDiv.innerHTML = "";
  let total = 0;
  const cart = await loadCart();
  if (cart.length === 0) {
    cartDiv.innerHTML = "<p style='text-align:center; color:#666;'>Your cart is empty. Start shopping!</p>";
    buyNowBtn.style.display = 'none';
  } else {
    cart.forEach((item, index) => {
      total += item.price * item.qty;
      const div = document.createElement("div");
      div.className = "cart-item";
      div.innerHTML = `
        <div style="display:flex; align-items:center; gap:12px; flex-wrap:wrap;">
          <img src="${item.image || 'https://via.placeholder.com/50x50.png?text=üì∑'}" alt="${item.name}" style="width:50px; height:50px; object-fit:cover; border-radius:8px; border:2px solid #d4c8a8;">
          <div>
            <strong>${item.name}</strong><br>
            <small>Category: ${item.category}</small><br>
            <small>Qty: ${item.qty} √ó ‚Çπ${item.price} = ‚Çπ${item.price * item.qty}</small>
          </div>
        </div>
        <button onclick="removeFromCart(${index})">Remove</button>
      `;
      cartDiv.appendChild(div);
    });
    buyNowBtn.style.display = 'block';
  }
  document.getElementById("cart-total").innerText = `Total: ‚Çπ${total}`;
}
/* UI Navigation */
function showRegister() {
  document.getElementById('login-container').style.display = 'none';
  document.getElementById('register-container').style.display = 'block';
}
function showLogin() {
  document.getElementById('login-container').style.display = 'block';
  document.getElementById('register-container').style.display = 'none';
}
function showPage(pageId, resetDisplay = true) {
  document.querySelectorAll("#store-content main section").forEach(sec => sec.classList.remove("active"));
  const el = document.getElementById(pageId);
  if (el) {
    el.classList.add("active");
    window.scrollTo({ top: 0, behavior: 'smooth' });
    if (pageId === 'products' && resetDisplay) {
      resetProductDisplay();
    }
    if (pageId === 'cart') {
      renderCart();
    }
    if (pageId === 'orders') {
      loadOrders();
    }
    if (pageId === 'profile') {
      loadProfile();
    }
    if (pageId === 'home') {
      const searchInput = document.getElementById('searchInput');
      if (searchInput && resetDisplay) {
        searchInput.value = '';
        currentSearchTerm = '';
        updateClearButtonVisibility();
      }
      document.getElementById('search-not-found')?.classList.remove('show');
    }
  }
  hideOrderModal();
}
/* Auth Handlers */
document.getElementById('loginForm').addEventListener('submit', e => {
  e.preventDefault();
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  auth.signInWithEmailAndPassword(email, password)
    .then(() => {
      document.getElementById('login-container').style.display = 'none';
      document.getElementById('store-content').style.display = 'block';
      if (document.getElementById('cart').classList.contains('active')) {
        renderCart();
      }
      if (document.getElementById('orders').classList.contains('active')) {
        loadOrders();
      }
    })
    .catch(err => showNotification('‚ùå Login failed: ' + err.message));
});
document.getElementById('registerForm').addEventListener('submit', e => {
  e.preventDefault();
  const email = document.getElementById('regEmail').value;
  const password = document.getElementById('regPassword').value;
  auth.createUserWithEmailAndPassword(email, password)
    .then(() => {
      showNotification("‚úÖ Account created successfully! Please login.");
      auth.signOut();
      document.getElementById("regEmail").value = "";
      document.getElementById("regPassword").value = "";
      showLogin();
    })
    .catch(err => showNotification('‚ùå Registration failed: ' + err.message));
});
function logout() {
  auth.signOut().then(() => {
    showNotification("‚úÖ Logged out successfully");
    location.reload();
  });
}
/* Search Functions */
function triggerSearch() {
  const q = document.getElementById('searchInput').value.toLowerCase().trim();
  currentSearchTerm = q;
  const cards = document.querySelectorAll("#productsGrid .card");
  let foundCount = 0;
  // Debug: Log the search term
  console.log(`[triggerSearch] Searching for: "${q}"`);
  // Navigate to products page without resetting display
  showPage('products', false);
  // Apply filtering
  cards.forEach(card => {
    const name = card.dataset.name ? card.dataset.name.toLowerCase().trim() : '';
    const category = card.dataset.category ? card.dataset.category.toLowerCase().trim() : '';
    const normalizedQuery = q.replace(/\s+/g, ' ');
    const isMatch = q === '' || name.includes(normalizedQuery) || category.includes(normalizedQuery);
    // Debug: Log each card's data and match status
    console.log(`[triggerSearch] Card: name="${name}", category="${category}", isMatch=${isMatch}`);
    if (isMatch) {
      card.style.display = "block";
      card.style.opacity = "1";
      card.style.transform = "translateY(0)";
      foundCount++;
    } else {
      card.style.display = "none";
    }
  });
  // Debug: Log the number of matches
  console.log(`[triggerSearch] Found ${foundCount} matching products`);
  updateSearchMessages(q, foundCount);
  if (!q) {
    resetProductDisplay();
  }
}
function searchProducts() {
  clearTimeout(searchTimeout);
  searchTimeout = setTimeout(() => {
    triggerSearch();
    updateClearButtonVisibility();
  }, 300);
}
function updateSearchMessages(query, foundCount) {
  const homeNotFound = document.getElementById('search-not-found');
  const productsNotFound = document.getElementById('products-search-not-found');
  const searchTermSpan = document.getElementById('searchTerm');
  const isHomeActive = document.getElementById('home').classList.contains('active');
  const isProductsActive = document.getElementById('products').classList.contains('active');
  if (homeNotFound) homeNotFound.classList.remove('show');
  if (productsNotFound) productsNotFound.classList.remove('show');
  if (query && foundCount === 0) {
    if (isHomeActive && homeNotFound) {
      if (searchTermSpan) searchTermSpan.textContent = query;
      homeNotFound.classList.add('show');
    } else if (isProductsActive && productsNotFound) {
      productsNotFound.classList.add('show');
    }
  }
}
/* Voice Search */
let recognitionRetryCount = 0;
const maxRetries = 3;
function startVoiceSearch() {
  const voiceBtn = document.getElementById('voice-btn');
  const searchInput = document.getElementById('searchInput');
  if (!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)) {
    showNotification('‚ùå Voice search is not supported in this browser. Try typingyour search instead.');
    return;
  }
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  const recognition = new SpeechRecognition();
  recognition.lang = 'en-US';
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;
  voiceBtn.classList.add('listening');
  recognition.start();
  recognition.onresult = (event) => {
    const transcript = event.results[0][0].transcript.toLowerCase().trim();
    // Enhanced transcript cleaning
    let cleanedTranscript = transcript
      .replace(/^(search|search for|find|look for)\s+/i, '') // Remove common voice command prefixes
      .replace(/[^a-z0-9\s]/g, '') // Remove punctuation
      .replace(/\s+/g, ' ') // Normalize spaces
      .trim();
    // Debug: Log raw and cleaned transcript
    console.log(`[VoiceSearch] Raw transcript: "${transcript}"`);
    console.log(`[VoiceSearch] Cleaned transcript: "${cleanedTranscript}"`);
    searchInput.value = cleanedTranscript;
    currentSearchTerm = cleanedTranscript;
    triggerSearch();
    updateClearButtonVisibility();
    voiceBtn.classList.remove('listening');
    recognitionRetryCount = 0;
  };
  recognition.onerror = (event) => {
    voiceBtn.classList.remove('listening');
    if (event.error === 'no-speech' && recognitionRetryCount < maxRetries) {
      recognitionRetryCount++;
      showNotification(`‚ö†Ô∏è No speech detected. Retrying (${recognitionRetryCount}/${maxRetries})...`);
      setTimeout(() => startVoiceSearch(), 1000);
    } else {
      recognitionRetryCount = 0;
      console.error('Voice recognition error:', event.error);
      showNotification(`‚ùå Voice search error: ${event.error}. Try again or type your search.`);
    }
  };
  recognition.onend = () => {
    if (voiceBtn.classList.contains('listening') && recognitionRetryCount < maxRetries) {
      recognitionRetryCount++;
      console.log(`[VoiceSearch] Retrying (${recognitionRetryCount}/${maxRetries})`);
      setTimeout(() => startVoiceSearch(), 1000);
    } else {
      voiceBtn.classList.remove('listening');
      recognitionRetryCount = 0;
    }
  };
}
/* Clear Button Functionality */
function updateClearButtonVisibility() {
  const searchInput = document.getElementById('searchInput');
  const clearBtn = document.getElementById('clear-btn');
  if (searchInput && clearBtn) {
    clearBtn.style.display = searchInput.value.trim() ? 'block' : 'none';
  }
}
function clearSearchInput() {
  const searchInput = document.getElementById('searchInput');
  if (searchInput) {
    searchInput.value = '';
    currentSearchTerm = '';
    updateClearButtonVisibility();
    if (document.getElementById('products').classList.contains('active')) {
      resetProductDisplay();
    } else {
      showPage('home', true);
    }
  }
}
/* Product Filters */
function filterCategory(category) {
  const cards = document.querySelectorAll("#productsGrid .card");
  currentSearchTerm = category;
  document.getElementById('searchInput').value = category;
  updateClearButtonVisibility();
  showPage('products', false);
  let foundCount = 0;
  cards.forEach(card => {
    const cardCategory = card.dataset.category.toLowerCase().trim();
    if (category === '' || cardCategory === category.toLowerCase()) {
      card.style.display = "block";
      card.style.opacity = "1";
      card.style.transform = "translateY(0)";
      foundCount++;
    } else {
      card.style.display = "none";
    }
  });
  updateSearchMessages(category, foundCount);
}
function resetProductDisplay() {
  const cards = document.querySelectorAll("#productsGrid .card");
  document.getElementById('products-search-not-found')?.classList.remove('show');
  document.getElementById('searchInput').value = '';
  currentSearchTerm = '';
  updateClearButtonVisibility();
  cards.forEach(card => {
    card.style.display = "block";
    card.style.opacity = "1";
    card.style.transform = "translateY(0)";
  });
}
function buyProduct(button) {
  const card = button.closest(".card");
  const name = card.dataset.name;
  const price = parseInt(card.dataset.price);
  const qty = parseInt(card.querySelector("input").value) || 1;
  const image = card.querySelector("img").src;
  const category = card.dataset.category;
  showOrderModal({ name, price, qty, image, category }, null);
}
async function loadOrders() {
  const user = auth.currentUser;
  const ordersList = document.getElementById('orders-list');
  ordersList.innerHTML = '<p style="text-align:center; color:#666;">Loading orders...</p>';
  if (!user) {
    ordersList.innerHTML = '<p style="text-align:center; color:#666;">Please log in to view your orders.</p>';
    return;
  }
  try {
    const querySnapshot = await db.collection('orders')
      .where('userId', '==', user.uid)
      .orderBy('orderDate', 'desc')
      .get();
    ordersList.innerHTML = '';
    if (querySnapshot.empty) {
      ordersList.innerHTML = '<p style="text-align:center; color:#666;">No orders found.</p>';
      return;
    }
    querySnapshot.forEach(doc => {
      const order = doc.data();
      const orderDiv = document.createElement('div');
      orderDiv.className = 'order-item';
      let itemsList = order.items.map(item => `
        <div style="margin:5px 0;">
          <img src="${item.image || 'https://via.placeholder.com/40x40.png?text=üì∑'}" alt="${item.name}" style="width:40px; height:40px; object-fit:cover; border-radius:6px; vertical-align:middle; margin-right:8px;">
          ${item.name} (Qty: ${item.quantity}, ‚Çπ${item.subtotal})
        </div>
      `).join('');
      orderDiv.innerHTML = `
        <div style="flex:1;">
          <p><strong>Order ID:</strong> ${doc.id}</p>
          <p><strong>Items:</strong></p>${itemsList}
          <p><strong>Total:</strong> ‚Çπ${order.total}</p>
          <p><strong>Payment:</strong> ${getPaymentMethodName(order.paymentMethod)}</p>
          <p><strong>Status:</strong> ${order.status}</p>
          <p><strong>Date:</strong> ${order.orderDate.toDate().toLocaleString()}</p>
          <p><strong>Shipping to:</strong> ${order.name}, ${order.address}, ${order.pincode}</p>
          <p><strong>Mobile:</strong> ${order.mobile}</p>
        </div>
        ${order.status === 'pending' ? `<button class="cancel-order" onclick="cancelOrder('${doc.id}')">Cancel Order</button>` : ''}
      `;
      ordersList.appendChild(orderDiv);
    });
  } catch (error) {
    console.error('Error loading orders:', error);
    ordersList.innerHTML = '<p style="text-align:center; color:#d9534f;">Error loading orders. Please try again.</p>';
  }
}
async function cancelOrder(orderId) {
  try {
    await db.collection('orders').doc(orderId).delete();
    showNotification('‚úÖ Order cancelled successfully.');
    await loadOrders();
  } catch (error) {
    console.error('Error cancelling order:', error);
    showNotification('‚ùå Failed to cancel order: ' + error.message);
  }
}
async function loadProfile() {
  const user = auth.currentUser;
  if (!user) {
    showNotification('‚ùå Please log in to view your profile.');
    showPage('login');
    return;
  }
  try {
    document.getElementById('profileEmail').textContent = user.email || 'No email';
    const profileDoc = await db.collection('users').doc(user.uid).get();
    if (profileDoc.exists) {
      const profile = profileDoc.data();
      document.getElementById('profileDisplayName').value = profile.displayName || '';
      document.getElementById('profilePhotoURL').value = profile.photoURL || '';
      document.getElementById('profileMobile').value = profile.mobileNumber || '';
      document.getElementById('profileAddress').value = profile.address || '';
      document.getElementById('profilePincode').value = profile.pincode || '';
      document.getElementById('profilePicPreview').src = profile.photoURL || 'https://via.placeholder.com/100x100.png?text=üë§';
    } else {
      document.getElementById('profileDisplayName').value = user.displayName || '';
      document.getElementById('profilePhotoURL').value = user.photoURL || '';
      document.getElementById('profileMobile').value = '';
      document.getElementById('profileAddress').value = '';
      document.getElementById('profilePincode').value = '';
      document.getElementById('profilePicPreview').src = user.photoURL || 'https://via.placeholder.com/100x100.png?text=üë§';
    }
  } catch (error) {
    console.error('Error loading profile:', error);
    showNotification('‚ùå Failed to load profile: ' + error.message);
  }
}
document.getElementById('saveProfileBtn').addEventListener('click', async () => {
  const user = auth.currentUser;
  if (!user) {
    showNotification('‚ùå Please log in to save your profile.');
    return;
  }
  const displayName = document.getElementById('profileDisplayName').value.trim();
  const photoURL = document.getElementById('profilePhotoURL').value.trim();
  const mobileNumber = document.getElementById('profileMobile').value.trim();
  const address = document.getElementById('profileAddress').value.trim();
  const pincode = document.getElementById('profilePincode').value.trim();
  try {
    await db.collection('users').doc(user.uid).set({
      displayName: displayName || user.displayName || null,
      photoURL: photoURL || user.photoURL || null,
      mobileNumber: mobileNumber || null,
      address: address || null,
      pincode: pincode || null,
      updatedAt: firebase.firestore.Timestamp.now()
    }, { merge: true });
    if (displayName || photoURL) {
      await user.updateProfile({
        displayName: displayName || user.displayName || null,
        photoURL: photoURL || user.photoURL || null
      });
    }
    showNotification('‚úÖ Profile saved successfully!');
    loadProfile();
  } catch (error) {
    console.error('Error saving profile:', error);
    showNotification('‚ùå Failed to save profile: ' + error.message);
  }
});
document.getElementById('deleteProfileBtn').addEventListener('click', async () => {
  const user = auth.currentUser;
  if (!user) {
    showNotification('‚ùå Please log in to delete your profile.');
    return;
  }
  if (!confirm('Are you sure you want to delete your profile data? This will clear your saved profile information but keep your account and orders.')) {
    return;
  }
  try {
    await db.collection('users').doc(user.uid).delete();
    await user.updateProfile({
      displayName: null,
      photoURL: null
    });
    showNotification('‚úÖ Profile data deleted successfully.');
    loadProfile();
  } catch (error) {
    console.error('Error deleting profile:', error);
    showNotification('‚ùå Failed to delete profile: ' + error.message);
  }
});
document.getElementById('contactForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const name = document.getElementById('contactName').value.trim();
  const email = document.getElementById('contactEmail').value.trim();
  const message = document.getElementById('contactMessage').value.trim();
  if (!name || !email || !message) {
    showNotification('‚ùå Please fill in all contact form fields.');
    return;
  }
  try {
    await db.collection('contacts').add({
      name: name,
      email: email,
      message: message,
      submittedAt: firebase.firestore.Timestamp.now(),
      userId: auth.currentUser ? auth.currentUser.uid : null
    });
    showNotification('‚úÖ Your message has been sent! We will get back to you soon.');
    document.getElementById('contactForm').reset();
    document.getElementById('contactFeedback').style.display = 'block';
    document.getElementById('contactFeedback').textContent = 'Thank you, ' + name + '! Your message was sent successfully.';
    setTimeout(() => {
      document.getElementById('contactFeedback').style.display = 'none';
    }, 5000);
  } catch (error) {
    console.error('Error submitting contact form:', error);
    showNotification('‚ùå Failed to send message: ' + error.message);
  }
});
/* Event Listeners */
document.getElementById('search-btn').addEventListener('click', triggerSearch);
document.getElementById('searchInput').addEventListener('input', searchProducts);
document.getElementById('voice-btn').addEventListener('click', startVoiceSearch);
document.getElementById('clear-btn').addEventListener('click', clearSearchInput);
document.getElementById('cart-buy-now').addEventListener('click', buyCartItems);
/* Auth State Listener */
auth.onAuthStateChanged(user => {
  if (user) {
    document.getElementById('login-container').style.display = 'none';
    document.getElementById('register-container').style.display = 'none';
    document.getElementById('store-content').style.display = 'block';
    if (document.getElementById('profile').classList.contains('active')) {
      loadProfile();
    }
    if (document.getElementById('cart').classList.contains('active')) {
      renderCart();
    }
    if (document.getElementById('orders').classList.contains('active')) {
      loadOrders();
    }
  } else {
    document.getElementById('store-content').style.display = 'none';
    document.getElementById('login-container').style.display = 'block';
    document.getElementById('register-container').style.display = 'none';
  }
});
</script>
</body>
</html>
